# PHP 远控服务端（延迟版）

这是一个简单的PHP远控服务端，支持延迟执行命令（即设置的命令等设备上线后再执行），包含后台管理界面，不加密。

## 功能特点

- 设备管理：添加、删除、查看设备信息
- 命令管理：发送命令、查看命令执行结果
- 延迟执行：设备离线时发送的命令，等设备上线后自动执行
- 实时监控：设备在线状态实时更新
- 命令历史：查看所有命令执行记录
- 文件存储：无需数据库，使用文件系统存储设备信息和命令

## 环境要求

- PHP 5.6+
- Web服务器（Apache/Nginx）

## 安装步骤

1. 将所有文件上传到Web服务器的根目录或子目录
2. 确保PHP具有写权限（用于创建存储目录和文件）
3. 访问后台管理界面：
   - 在浏览器中访问 `http://your-domain/index.php`

## 文件结构

```
.
├── storage.php         # 文件存储工具类
├── server.php          # 服务端核心文件
├── index.php           # 后台管理界面
├── style.css           # 样式文件
├── client.php          # 客户端示例脚本
├── README.md           # 说明文档
└── storage/            # 存储目录（自动创建）
    ├── devices/        # 设备信息存储
    └── commands/       # 命令存储
```

## 使用说明

### 1. 设备上线

设备需要运行 `client.php` 脚本才能上线。客户端脚本会自动连接到服务端，并定期发送心跳。

```bash
php client.php
```

### 2. 发送命令

1. 在后台管理界面点击"设备管理"
2. 找到要发送命令的设备
3. 在"发送命令"文本框中输入要执行的命令
4. 点击"发送命令"按钮

### 3. 查看命令结果

1. 在后台管理界面点击"命令管理"
2. 可以看到所有命令的执行状态和结果
3. 命令状态说明：
   - 0：待执行
   - 1：执行中
   - 2：已完成

## 客户端工作流程

1. 设备启动，生成唯一的设备ID
2. 向服务端发送上线请求
3. 定期向服务端发送心跳，保持在线状态
4. 定期从服务端获取待执行命令
5. 执行命令并将结果返回给服务端
6. 重复步骤3-5

## 注意事项

1. 本系统不加密，请勿在生产环境中使用
2. 建议只在内部网络中使用
3. 定期清理命令历史，避免数据库过大
4. 客户端脚本需要有执行命令的权限

## 安全建议

1. 添加认证机制，限制后台访问
2. 对命令进行过滤，防止恶意命令执行
3. 加密传输数据，保护通信安全
4. 定期更新系统，修复安全漏洞

## 常见问题

### 1. 设备无法上线

- 检查服务端地址是否正确
- 检查网络连接是否正常
- 检查服务端是否正常运行

### 2. 命令无法执行

- 检查客户端是否有执行命令的权限
- 检查命令格式是否正确
- 检查服务端日志，查看是否有错误信息

### 3. 后台无法访问

- 检查Web服务器是否正常运行
- 检查文件权限是否正确
- 检查数据库连接是否正常

## 许可证

本项目采用MIT许可证，可自由使用和修改。

## 作者

TraeAI
